<!DOCTYPE html><html lang="zh"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>在PDF中隐藏信息的两种方式 | 腦洞</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">在PDF中隐藏信息的两种方式</h1><a id="logo" href="/.">腦洞</a><p class="description">简小个奇的博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> 首頁</i></a><a href="/archives/"><i class="icon-archive"> 所有文章</i></a><a href="/about/"><i class="icon-about"> 關於</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">在PDF中隐藏信息的两种方式</h1><div class="post-meta">2016-03-05 | <span class="categories">分類於<a href="/categories/ctf/"> ctf</a></span></div><span data-disqus-identifier="2016/2/" class="disqus-comment-count"></span><div class="post-content"><h2 id="0x00__u524D_u8A00"><a href="#0x00__u524D_u8A00" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>之前在SSCTF上遇到了一道PDF隐写的题目，然后随便一搜，竟然发现了一个关于PDF信息隐藏的专利。这里就研究下题目里面涉及的方式以及这个专利。<br>开始之前，有必要先介绍下PDF的文件结构：<br>一个PDF文件大概可以分成这四个部分<br><img src="/images/2016030501.jpg" alt="Alt text"></p>
<blockquote>
<p>文件头，指明了该文件所遵从的PDF规范的版本号，它出现在PDF文件的第一行。<br>文件体，PDF文件的主要部分，由一系列对象组成。<br>交叉引用表，为了能对间接对象进行随机存取而设立的一个间接对象的地址索引表。<br>文件尾，声明了交叉引用表的地址，即指明了文件体的根对象（Catalog），从而能够找到PDF文件中各个对象体的位置，到随机访问。</p>
</blockquote>
<p>如果有兴趣，这里还有对PDF文件本身物理机构更详细的解析<br><a href="http://blog.csdn.net/bobob/article/details/4328426" target="_blank" rel="external">PDF文件结构(一)</a> 以及 <a href="http://blog.csdn.net/bobob/article/details/4328450" target="_blank" rel="external">PDF文件结构(二)</a></p>
<h2 id="0x01__u57FA_u4E8E_PDF__u6587_u4EF6_u4F53_u8FDB_u884C_u4FE1_u606F_u9690_u85CF"><a href="#0x01__u57FA_u4E8E_PDF__u6587_u4EF6_u4F53_u8FDB_u884C_u4FE1_u606F_u9690_u85CF" class="headerlink" title="0x01 基于 PDF 文件体进行信息隐藏"></a>0x01 基于 PDF 文件体进行信息隐藏</h2><p>这就是在《数据隐藏技术揭秘》3.2.3　在PDF文件中隐藏信息中提到的方法：<br>可以利用<a href="http://wbstego.wbailer.com" target="_blank" rel="external">wbStego4open</a>这个开源的工具将数据隐藏到PDF文件中。</p>
<p>首先，wbStego4open会把插入数据中的每一个ASCII码转换为二进制形式，然后把每一个二进制数字再替换为十六进制的20或者09，20代表0，09代表1。()比如：s 二进制表示为 1110011 编码后为 2009 0909 2020 0909 )并将其插入到文件体中的两个 obj 之间。<br>一个正常的PDF<br><img src="/images/2016030502.png" alt="Alt text"><br>我们很容易发现，在不 Body 中 不同的 obj 之间以 0D0A 进行分隔<br>然后我们看藏有数据的文件<br><img src="/images/2016030503.png" alt="Alt text"><br>然而不同 obj 的引用依赖交叉引用表实现。阅读器并不会读取这些存储于两个 obj 之间的信息，从而达到信息隐藏的目的。</p>
<p>读取信息的时候，把这些8位字节取出来后，组合后即可获得其所代表的ASCII码的二进制形式，然后再把二进制码转换成ASCII码就能得到原始消息了。</p>
<p>这里有我的一些疑问：为什么要用 20 和09 来表示01 这里只是随便选的还是有其他的原因？</p>
<h2 id="0x02__u57FA_u4E8E_PDF__u4EA4_u53C9_u5F15_u7528_u8868_u7684_u4FE1_u606F_u9690_u85CF"><a href="#0x02__u57FA_u4E8E_PDF__u4EA4_u53C9_u5F15_u7528_u8868_u7684_u4FE1_u606F_u9690_u85CF" class="headerlink" title="0x02 基于 PDF 交叉引用表的信息隐藏"></a>0x02 基于 PDF 交叉引用表的信息隐藏</h2><p>发现这个方法的时候是在google上发现了这个专利<br><a href="http://www.google.com/patents/CN102622562B?cl=zh" target="_blank" rel="external">基于pdf交叉引用表的pdf文件信息嵌入和提取方法</a></p>
<ol>
<li>读入二进制隐藏信息并对其进行编码得到十进制<br>比如我们要将 <code>0111 0100 0110 0101 0111 0011 0111 0100</code>(test)<br>这样一段二进制信息隐藏到PDF文件里，我们转换成10进制得到字符串<code>1952805748</code></li>
<li>我们以长度4进行分段得到<code>1952</code> <code>8057</code> <code>48</code>n个这样的十进制序列</li>
<li>以分段后的十进制序列值为长度生成 n+1 内容随机的新对象(obj)以文本追加的方式插入到原始的PDF中<code>20 0 obj..&lt;&lt;/Filter/FlateDe code/Length 1952&gt;&gt; * ..endobj</code>其中最后一个即第n+1个新对象的长度随机，第I个到倒数第2个即第I个到第n个新对象的长度依次等于十进序列中的第I到第n<br> 项的值</li>
<li><p>等n+1个对象嵌入完毕后写入象对应的新交叉引用表和新文件尾，完成一次追加更新，并同时生成新交叉引用表标志；</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xref&#10;&#8230;&#8230;&#10;0000000017 00000 n&#10;0000001969 00000 n&#10;0000010026 00000 n&#10;0000010074 00000 n&#10;&#8230;&#8230;</span><br></pre></td></tr></table></figure>
<p> 至此，带有隐藏信息的PDF文件已经建立完毕，由于交叉引用表中的偏移量记录的是从PDF文件开头到交叉引用表所对应的对象的开头的字节数，因此，隐藏信息就被嵌入到新交叉引用表的偏移量中。</p>
</li>
</ol>
<p>这里写的要比专利里面讲的简单很多，专利里讲到从二进制转十进制的时候可以对十进制值各加上一个设定的十进制阈值，然后可以对这个序列采用一些加密策略加密，最后输出含隐藏信息的PDF文件，以及输出隐藏信息长度、分段长度、加密参数、设定的十进制阈值、新交叉引用表标志作为密钥。<br>很奇怪这里为什么要单独强调交叉引用表，新的交叉引用表应该已经被包含进入新的PDF文件里了，也许是疏忽？</p>
<h2 id="0x03__u540E_u8BB0"><a href="#0x03__u540E_u8BB0" class="headerlink" title="0x03 后记"></a>0x03 后记</h2><p>像PDF这种有点类似于xml标记的文件格式，应该会存在很多通用的隐写术上的小技巧，我也没有去研究过，只是刚巧发现了这两种就记录了下来，后面发现了PDF不同的版本还有一些版本上的特性，应该还会有很多好好玩的东西，等待发觉，没准，一不小心就又是一个专利呢（逃</p>
</div><div class="tags"><a href="/tags/ctf/">ctf</a></div><div class="post-nav"><a href="/2016/1/" class="next">wargame-natas系列总结<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'naodong2';
var disqus_identifier = '2016/2/';
var disqus_title = '在PDF中隐藏信息的两种方式';
var disqus_url = 'http://blog.wochengrenwonaocanle.com/2016/2/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//naodong2.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://blog.wochengrenwonaocanle.com"/></form></div><div class="widget"><div class="widget-title">分類</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ctf/">ctf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/wargame/">wargame</a></li></ul></div><div class="widget"><div class="widget-title">標籤</div><div class="tagcloud"><a href="/tags/wargame/" style="font-size: 15px;">wargame</a> <a href="/tags/natas/" style="font-size: 15px;">natas</a> <a href="/tags/ctf/" style="font-size: 15px;">ctf</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/2/">在PDF中隐藏信息的两种方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/1/">wargame-natas系列总结</a></li></ul></div><div class="widget"><div class="widget-title">最近評論</div><script type="text/javascript" src="//naodong2.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">腦洞.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/codeblock-resizer.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-73053047-1','auto');ga('send','pageview');
</script></div></body></html>